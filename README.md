# 愛知県ジグソーパズル 🧩

愛知県の市町村をピースとした、インタラクティブなジグソーパズルゲームです。

## 🎮 特徴

- **4つの難易度レベル**
  - Level 1（カラー）: カラフルな背景で初心者向け
  - Level 2（グレー）: グレースケールの背景で中級者向け
  - Level 3（ハード）: より難しい背景画像
  - Level EX（エクストラ）: 上級者向けの最高難易度

- **直感的な操作**
  - ドラッグ&ドロップでピースを配置
  - 右クリックまたはスペース+左クリックでキャンバスをパン
  - Ctrl+ホイールでズーム調整
  - ピースのグループ化機能（正しく配置されたピースは自動的にグループ化）

- **便利な機能**
  - 自動スナップ機能（正しい位置に近づくと自動的に配置）
  - 自動ロック機能（正しく配置されたピースを固定）
  - ヒントボタン（押している間カラー版の背景を表示）
  - 進行状況の表示
  - タイマー機能

## 🚀 セットアップ

### 必要な環境
- Node.js (v14以上推奨)
- npm または yarn

### インストール

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev

# ビルド
npm run build
```

## 📖 使い方

### 基本操作

- **ピースの移動**: ピースを左クリックでドラッグ
- **キャンバスの移動**: 右クリックでドラッグ、またはスペースキー+左クリックでドラッグ
- **ズーム**: Ctrl+マウスホイール、または画面右下のズームボタン
- **ヒント表示**: ヒントボタンを押している間、カラー版の背景を表示

### レベル選択

サイドバーのレベル選択ボタンから、4つの難易度を選択できます。レベルを変更すると背景画像が変わりますが、ピースの配置は同じです。

### 設定

- **自動ロック**: 正しく配置されたピースを自動的にロックします
- **スナップ距離**: 正しい位置に近づいたときに自動配置される距離（50px固定）

## 🛠️ 技術スタック

- **Vite**: 開発サーバーとビルドツール
- **Vanilla JavaScript**: フレームワーク不要のピュアJavaScript
- **Tailwind CSS**: ユーティリティファーストのCSSフレームワーク
- **pngjs**: 画像解析とピース座標の自動検出

## 📁 プロジェクト構造

```
045_aichipazuru/
├── img/                          # 背景画像
│   ├── 愛知県全図color.png      # Level 1の背景
│   ├── 愛知県全図.png            # Level 2の背景
│   ├── hard.png                  # Level 3の背景
│   └── Ex.png                    # Level EXの背景
├── color_cities/                 # パズルピース画像（65個の市町村）
├── public/
│   └── data/
│       └── coordinates.json      # ピースの座標データ
├── src/
│   └── jigsaw.js                 # メインゲームロジック
├── scripts/
│   └── analyze-coordinates.js    # 座標自動解析スクリプト
├── puzzle.html                   # メインHTMLファイル
└── package.json
```

## 🔧 座標データの生成

ピースの正しい位置は、画像解析により自動的に検出されます。

```bash
npm run analyze
```

このコマンドを実行すると、`public/data/coordinates.json` に各ピースの座標データが生成されます。

## 🎯 ゲームの仕組み

### Union-Find アルゴリズム

正しく配置されたピースのグループ化には、Union-Find（Disjoint Set）データ構造を使用しています。これにより、隣接するピースが正しい位置に配置されたときに効率的にグループ化できます。

### 隣接関係の事前計算

ゲーム開始時に、すべてのピースの隣接関係を事前に計算し、マップとして保持しています。これにより、ピースが正しい位置に配置されたときに、どのピースと結合すべきかを高速に判定できます。

### 画像マッチング

座標解析スクリプトでは、テンプレートマッチング手法を使用して、各ピースが背景画像のどこに配置されるべきかを自動検出します。平均98.3%のマッチ率を達成しています。

## 📝 ライセンス

このプロジェクトはプライベートプロジェクトです。

## 🙏 謝辞

愛知県の地理データを使用しています。
